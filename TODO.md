# 项目功能分析与待办

## 一、当前已实现能力

| 模块         | 能力                                                                                                                |
| ------------ | ------------------------------------------------------------------------------------------------------------------- |
| **Monorepo** | Turborepo + pnpm，backend (Hono) + frontend (React/Vite)，packages/types                                            |
| **后端基础** | CORS、统一响应格式、健康检查 `/health`、环境变量集中管理                                                            |
| **用户认证** | User 表（Prisma/MySQL）、注册/登录 API、JWT 签发与校验、`jwtAuth` 中间件、`GET /api/me`                             |
| **AI 对话**  | `POST /api/ai/chat` 流式 UI 消息、环境配置 Provider/Model（OpenAI、DeepSeek）、web_search、本地工具 `get_server_ip` |
| **前端**     | 首页、About、登录/注册页、Chat 页（useChat + 流式 + 工具展示）、个人信息页、路由保护（/chat、/me）                  |
| **前端 API** | `request()` 带 Bearer、`getMe()`、401 时清 token 并跳转登录                                                         |

---

## 二、待办列表（Todo List）

### 高优先级


### 中优先级


### 低优先级

- [ ] **migrate 执行策略可控**：后端启动跑 `prisma migrate deploy` 改为可开关（如 `RUN_MIGRATIONS=true`），避免扩容/滚动发布冲突
- [ ] **请求日志增强**：补齐 requestId/耗时/用户 id（已登录），错误结构统一，提升排障与前端 toast 体验
- [ ] **统一前端错误提示**：toast + 请求重试策略（对 401/5xx/网络错误区分处理）
- [ ] **移除 compose 中硬编码敏感信息**：`DATABASE_URL`/公网 IP/账号密码改用 `.env` 或 `env_file`，并确保不进 git
- [ ] **生产环境密钥强校验**：`NODE_ENV=production` 时缺失 `JWT_SECRET`/`AI_KEY_ENCRYPTION_SECRET` 直接启动失败（禁止弱默认值）
- [ ] **清理 Prisma 配置敏感输出**：移除 `prisma.config.ts` 打印 `DATABASE_URL`；避免加载 `.env.example` 污染运行环境
- [ ] **Docker 健康检查**：backend 增加 `/health` healthcheck，frontend 依赖 backend 健康再启动（减少 502/冷启动问题）

### 按需

- [ ] **修改密码**：需登录 + 旧密码校验
- [ ] **忘记密码 / 重置密码**：需邮箱或其它找回方式（当前无邮箱字段可后续加）
- [ ] **用户资料编辑**：用户名/头像等（User 表可扩展字段）
- [ ] **会话/消息沉淀能力**：会话列表、历史回放、重命名/✅删除、自动标题（可选 AI）
- [ ] **限流与防爆破**：登录/注册/`/api/ai/chat` 增加简单 rate limit（按 IP/用户）
- [ ] **测试**：auth、ai chat 单元/集成测试；前端关键流程 E2E
- [ ] **API 文档**：OpenAPI/Swagger 或 README 中列出接口与示例
- [ ] **更多 AI 本地工具**：如查库、调用内部 API

### 已规划功能

---

## 三、推荐实施顺序

   - compose 移除硬编码敏感信息 + 生产密钥强校验（安全与合规）
   - Docker 健康检查 + migrate 可控（部署稳定性）
   - AI SDK 打印完整 HTTP 请求/返回（排障效率提升）
   - 请求日志增强 + 前端错误 toast（可观测性与体验）
   - 修改密码（先闭环站内账号体系）
   - API 文档（接口可维护、便于部署联调）
   - 会话/消息沉淀（把现有表变成产品能力）
   - 测试（auth、ai chat；前端关键流程 E2E）
   - 忘记密码 / 重置密码（引入邮箱后再做）
   - 更多 AI 本地工具（按业务扩展）

## 已完成项目

- ✅ **会话删除功能**：支持单个/批量删除会话

---

## 四、产品规划（产品经理视角）

### 4.1 核心价值定位

**当前产品状态**：基础 AI 对话平台，支持多 LLM 提供商、会话管理、工具调用

**目标用户画像**：
- 开发者/技术爱好者：需要灵活的 AI 助手，可自定义模型配置
- 企业用户：需要私有化部署、数据安全、团队协作
- 个人用户：日常 AI 对话、知识管理、内容创作

### 4.2 功能优先级矩阵（按用户价值与实现成本）

#### 🔥 P0 - 核心体验提升（立即开发）

**1. 会话管理完整化** ⭐⭐⭐⭐⭐
- **用户价值**：提升留存，用户可找回历史对话
- **功能点**：
  - ✅ 会话列表（已有基础）
  - ⬜ 会话重命名（手动 + AI 自动生成标题）
  - ✅ 会话删除（单个/批量）
  - ⬜ 会话搜索（按标题/内容）
  - ⬜ 会话归档/收藏
- **预期影响**：用户留存率 +30%，日活 +20%

**2. 消息历史完整回放** ⭐⭐⭐⭐⭐
- **用户价值**：无缝续聊，上下文不丢失
- **功能点**：
  - ✅ 消息存储（已有）
  - ⬜ 会话切换时自动加载历史消息
  - ⬜ 消息编辑/删除
  - ⬜ 消息复制/导出（Markdown/JSON）
  - ⬜ 消息搜索（全文检索）
- **预期影响**：用户满意度 +40%

**3. 用户资料与设置** ⭐⭐⭐⭐
- **用户价值**：个性化体验，账号安全感
- **功能点**：
  - ⬜ 修改密码
  - ⬜ 用户头像上传
  - ⬜ 用户名修改
  - ⬜ 个人偏好设置（主题、语言、默认模型）
  - ⬜ 邮箱绑定（为后续密码找回做准备）
- **预期影响**：账号安全性提升，用户信任度 +25%

#### 🚀 P1 - 差异化功能（3个月内）

**4. AI 工具生态扩展** ⭐⭐⭐⭐⭐
- **用户价值**：从"对话"升级为"智能助手"，解决实际问题
- **功能点**：
  - ⬜ **代码执行工具**：Python/JavaScript 沙箱执行
  - ⬜ **文件操作工具**：上传/下载/解析（PDF、Word、Excel、图片）
  - ⬜ **数据库查询工具**：连接用户数据库，执行 SQL（需授权）
  - ⬜ **API 调用工具**：用户自定义 API 端点，AI 可调用
  - ⬜ **知识库检索工具**：RAG，基于用户上传文档问答
- **预期影响**：产品差异化，用户粘性 +50%，可考虑付费功能

**5. 多模态能力** ⭐⭐⭐⭐
- **用户价值**：支持图片理解与生成，覆盖更多场景
- **功能点**：
  - ⬜ 图片上传与理解（Vision API）
  - ⬜ 图片生成（DALL-E、Midjourney API）
  - ⬜ 图片编辑/标注
  - ⬜ 文档 OCR 识别
- **预期影响**：使用场景扩展，用户时长 +35%

**6. 提示词模板库** ⭐⭐⭐⭐
- **用户价值**：降低使用门槛，提升对话质量
- **功能点**：
  - ⬜ 内置提示词模板（代码生成、翻译、总结、写作等）
  - ⬜ 用户自定义模板（保存/分享）
  - ⬜ 模板市场（社区分享）
  - ⬜ 一键应用模板
- **预期影响**：新用户上手率 +40%，对话质量 +30%

#### 💎 P2 - 增长与留存（6个月内）

**7. 协作功能** ⭐⭐⭐⭐
- **用户价值**：从个人工具升级为团队工具
- **功能点**：
  - ⬜ 会话分享（公开链接/密码保护）
  - ⬜ 团队空间（多用户共享会话）
  - ⬜ 权限管理（只读/编辑/管理员）
  - ⬜ 评论与标注
- **预期影响**：B2B 商业化基础，客单价 +200%

**8. 数据分析与洞察** ⭐⭐⭐
- **用户价值**：了解使用情况，优化对话策略
- **功能点**：
  - ⬜ 使用统计（对话次数、Token 消耗、模型分布）
  - ⬜ 成本分析（按模型/时间维度）
  - ⬜ 对话质量评分
  - ⬜ 导出报告
- **预期影响**：企业用户付费转化 +15%

**9. 移动端适配** ⭐⭐⭐⭐
- **用户价值**：随时随地使用，提升使用频率
- **功能点**：
  - ⬜ 响应式设计优化（已有基础）
  - ⬜ PWA 支持（离线缓存、推送通知）
  - ⬜ 移动端原生 App（React Native/Flutter）
  - ⬜ 语音输入/输出
- **预期影响**：日活 +60%，用户时长 +50%

#### 🎯 P3 - 商业化功能（12个月内）

**10. 订阅与计费** ⭐⭐⭐⭐⭐
- **用户价值**：为高级功能付费，获得更好体验
- **功能点**：
  - ⬜ 免费版限制（每日对话次数、Token 限制）
  - ⬜ 订阅计划（基础版/专业版/企业版）
  - ⬜ 支付集成（Stripe/支付宝/微信支付）
  - ⬜ 使用量监控与告警
  - ⬜ 发票管理
- **预期影响**：商业化闭环，ARPU +300%

**11. 白标与企业定制** ⭐⭐⭐
- **用户价值**：企业私有化部署，品牌定制
- **功能点**：
  - ⬜ 品牌定制（Logo、主题色、域名）
  - ⬜ 私有化部署方案（Docker Compose/K8s）
  - ⬜ SSO 集成（SAML/OAuth）
  - ⬜ 审计日志
  - ⬜ SLA 保障
- **预期影响**：B2B 收入，客单价 +500%

**12. API 开放平台** ⭐⭐⭐⭐
- **用户价值**：开发者生态，第三方集成
- **功能点**：
  - ⬜ REST API 文档（OpenAPI）
  - ⬜ API Key 管理
  - ⬜ Webhook 支持
  - ⬜ SDK（Python/JavaScript/Go）
  - ⬜ API 使用统计与限流
- **预期影响**：生态建设，开发者用户 +200%

### 4.3 功能依赖关系

```
基础能力（已完成）
  ├─ 会话管理完整化 ← 立即开发
  ├─ 消息历史回放 ← 立即开发
  ├─ 用户资料设置 ← 立即开发
  │
  ├─ AI 工具生态 ← 3个月（依赖会话管理）
  ├─ 多模态能力 ← 3个月（独立）
  ├─ 提示词模板 ← 3个月（独立）
  │
  ├─ 协作功能 ← 6个月（依赖会话管理）
  ├─ 数据分析 ← 6个月（依赖消息存储）
  ├─ 移动端适配 ← 6个月（独立）
  │
  ├─ 订阅计费 ← 12个月（依赖使用统计）
  ├─ 企业定制 ← 12个月（依赖协作功能）
  └─ API 开放平台 ← 12个月（独立）
```

### 4.4 关键指标（KPI）

**用户增长**：
- 注册用户数（月增长 20%+）
- DAU/MAU 比率（目标 >30%）
- 新用户 7 日留存率（目标 >40%）

**产品体验**：
- 平均会话时长（目标 >10 分钟）
- 每日对话次数（目标 >5 次/用户）
- 用户满意度（NPS >50）

**商业化**：
- 付费转化率（目标 >5%）
- ARPU（目标 >$20/月）
- 客户生命周期价值（LTV >$200）

### 4.5 风险与挑战

**技术风险**：
- LLM API 成本控制（需限流与缓存）
- 大规模并发处理（需优化架构）
- 数据安全与隐私（需加密与审计）

**产品风险**：
- 与 ChatGPT/Claude 等竞品差异化不足
- 用户教育成本高（需降低使用门槛）
- 商业化路径不清晰（需验证付费意愿）

**应对策略**：
- 聚焦垂直场景（开发者工具、企业知识库）
- 强化工具生态（代码执行、数据库查询）
- 提供私有化部署（企业用户）

### 4.6 推荐实施路线图

**Q1（当前季度）**：
1. 会话管理完整化（✅删除、重命名、搜索）
2. 消息历史完整回放
3. 用户资料与设置（修改密码、头像）
4. 基础工具扩展（文件上传、代码执行）

**Q2**：
1. 提示词模板库
2. 多模态能力（图片理解）
3. 数据分析仪表板
4. 移动端 PWA 优化

**Q3**：
1. 协作功能（会话分享、团队空间）
2. 知识库 RAG
3. 订阅与计费系统
4. API 开放平台

**Q4**：
1. 企业定制功能
2. 高级工具（数据库查询、API 调用）
3. 移动端原生 App
4. 生态建设（模板市场、插件系统）

---

