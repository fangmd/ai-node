services:
  backend:
    build:
      context: .
      dockerfile: apps/backend/Dockerfile
    # 不映射端口到宿主机，仅在同一 Docker 网络内供 frontend 的 nginx 代理访问
    # ports:
    #   - "3000:3000"
    environment:
      PORT: "3000"
      NODE_ENV: production
      DATABASE_URL: ${DATABASE_URL}
      JWT_SECRET: ${JWT_SECRET:-change-me-in-production}
      JWT_EXPIRES_IN: ${JWT_EXPIRES_IN:-7d}
      AI_KEY_ENCRYPTION_SECRET: ${AI_KEY_ENCRYPTION_SECRET:-change-me-to-a-long-random-secret}

  frontend:
    build:
      context: .
      dockerfile: apps/frontend/Dockerfile
    ports:
      - "80:80"
    depends_on:
      - backend
